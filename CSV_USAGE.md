# CSV文件处理说明

## 更新内容

已将原来的Excel文件读取功能更新为CSV文件读取功能，支持读取三位医生的评分文件并计算平均分。

## 文件格式要求

### 输入文件
在输入目录中需要放置三个CSV文件：
- `doctor_1_scores.csv`
- `doctor_2_scores.csv` 
- `doctor_3_scores.csv`

### CSV文件格式
每个CSV文件应包含以下列：
```
序号,静态_眼,静态_鼻唇沟,静态_口,静态_总分（×5）,动态_抬眉,动态_轻闭眼,动态_皱鼻,动态_咧嘴笑,动态_撅嘴,动态_总分（×4）,联动_抬眉,联动_轻闭眼,联动_皱鼻,联动_咧嘴笑,联动_撅嘴,联动_总分,总评分
```

### 示例数据
```csv
序号,静态_眼,静态_鼻唇沟,静态_口,静态_总分（×5）,动态_抬眉,动态_轻闭眼,动态_皱鼻,动态_咧嘴笑,动态_撅嘴,动态_总分（×4）,联动_抬眉,联动_轻闭眼,联动_皱鼻,联动_咧嘴笑,联动_撅嘴,联动_总分,总评分
1,1,0,0,5,4,5,4,4,2,76,0,0,0,0,0.0,0,71
2,1,0,0,5,3,3,3,1,2,48,1,0,1,1,0.0,3,40
3,1,1,1,15,1,2,1,1,2,28,0,0,0,0,0.0,0,13
```

## 处理流程

1. **文件检测**：系统会自动在输入目录中查找三个医生的CSV文件
2. **数据读取**：读取所有找到的医生评分文件
3. **平均分计算**：对于每个评分列，计算三位医生的平均分
4. **四舍五入取整**：将平均分四舍五入取整数
5. **数据输出**：输出格式保持与原来一致

## 修改的文件

### `video/batch_processor.py`
- 修改了 `_load_score_table()` 方法
- 从读取Excel文件改为读取三个CSV文件
- 增加了平均分计算和四舍五入功能

### `video/video_processor.py`
- 调整了患者行查找逻辑以适配CSV格式

## 使用方法

1. 将三个医生的评分CSV文件放在输入目录中
2. 运行批量处理程序：
   ```python
   from video.batch_processor import BatchProcessor
   
   processor = BatchProcessor("path/to/model")
   processor.process_directory("input_dir", "output_dir")
   ```

## 注意事项

1. **文件命名**：CSV文件名必须严格按照 `doctor_1_scores.csv`、`doctor_2_scores.csv`、`doctor_3_scores.csv` 命名
2. **编码格式**：CSV文件建议使用UTF-8编码
3. **数据格式**：确保数值列包含有效的数字数据
4. **缺失值处理**：系统会自动处理NaN值和空值
5. **兼容性**：如果只有部分医生的文件存在，系统仍可以正常工作，会基于可用的文件计算平均分

## 输出格式

输出的JSON文件中，评分数据将是三位医生的平均分（四舍五入取整），格式与之前保持一致：
```json
{
  "dynamics": 4,
  "synkinesis": 1
}
```

## 错误处理

- 如果找不到任何医生评分文件，会输出警告并继续处理
- 如果某个CSV文件读取失败，会记录错误信息但不影响其他文件的处理
- 如果找不到患者对应的评分数据，会在JSON中设置为null值
